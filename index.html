<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>National University Exam Routine 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .card-gradient {
            background: linear-gradient(145deg, #2d3748, #1a202c);
        }
        .countdown-item {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .table-header {
            background-color: #2d3748;
        }
        .clock-container {
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }

        /* --- Responsive Table CSS for Mobile View --- */
        @media (max-width: 767px) {
            .responsive-table thead {
                /* Hide the table header on mobile */
                display: none;
            }
            .responsive-table tbody, .responsive-table tr, .responsive-table td {
                /* Make table elements stack vertically */
                display: block;
                width: 100%;
            }
            .responsive-table tr {
                /* Style each row as a card */
                margin-bottom: 1rem;
                border-radius: 0.5rem;
                overflow: hidden;
                border: 1px solid #2d3748;
                background-color: #2d3748;
            }
            .responsive-table td {
                /* Align text and create space for the data label */
                text-align: right;
                padding-left: 50%;
                position: relative;
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
                padding-right: 1rem;
                border-bottom: 1px solid #1a202c;
            }
            .responsive-table td:last-child {
                border-bottom: 0;
            }
            .responsive-table td::before {
                /* Add the data label as a pseudo-element */
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 45%;
                padding-left: 1rem;
                font-weight: 600;
                text-align: left;
                white-space: nowrap;
                color: #a0aec0; /* Lighter text for the label */
            }
        }
    </style>
</head>
<body class="text-white">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <!-- Header Section -->
        <header class="text-center mb-8 md:mb-12">
            <img src="https://www.anandamohangovtcollege.edu.bd/public/uploads/logo/_%E0%A6%AE%E0%A7%8B%E0%A6%B9%E0%A6%A8_%E0%A6%95%E0%A6%B2%E0%A7%87%E0%A6%9C%E0%A7%87%E0%A6%B0_%E0%A6%B2%E0%A7%8B%E0%A6%97%E0%A7%8B-1725471905.png" alt="College Logo" class="mx-auto mb-4 h-20 w-20" onerror="this.onerror=null;this.src='https://placehold.co/80x80/1a202c/ffffff?text=Logo';">
            <h1 class="text-2xl sm:text-3xl md:text-5xl font-bold font-orbitron tracking-wider">National University</h1>
            <h2 class="text-lg sm:text-xl md:text-2xl font-semibold mt-2">Honours 1st Year Exam Routine - 2024</h2>
            <p class="text-base sm:text-lg md:text-xl text-cyan-400">Subject: Mathematics</p>
            <div id="clock" class="text-xl sm:text-2xl md:text-3xl font-orbitron mt-6 p-3 sm:p-4 bg-gray-900 rounded-lg shadow-lg inline-block clock-container"></div>
        </header>

        <!-- Countdown Timers Section -->
        <main id="countdown-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 mb-12">
            <!-- Countdown cards will be injected here by JavaScript -->
        </main>

        <!-- Full Routine Table Section -->
        <section class="bg-gray-800/50 rounded-lg shadow-2xl overflow-hidden">
            <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-center py-4 sm:py-6 table-header">Full Exam Schedule</h3>
            <div class="overflow-x-auto p-4 md:p-0">
                <table class="w-full text-center responsive-table">
                    <thead>
                        <tr>
                            <th class="p-4 font-semibold">Code</th>
                            <th class="p-4 font-semibold">Paper Title</th>
                            <th class="p-4 font-semibold">Date</th>
                            <th class="p-4 font-semibold">Day</th>
                            <th class="p-4 font-semibold">Time</th>
                        </tr>
                    </thead>
                    <tbody id="routine-table-body">
                        <!-- Routine rows will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="text-center mt-12 py-4">
            <p class="text-gray-500 text-sm">
                &copy; <span id="year"></span> MD Mahfiz Kaif. All Rights Reserved. | 
                <span class="inline-flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    Visitors: <span id="visitor-count">Loading...</span>
                </span>
            </p>
        </footer>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const exams = [
            { code: "211501", title: "History Of Bangladesh", date: "2025-08-24T13:30:00" },
            { code: "213701", title: "Fundamentals of Mathematics", date: "2025-08-28T13:30:00" },
            { code: "213703", title: "Calculus - I", date: "2025-08-31T13:30:00" },
            { code: "213705", title: "Linear Algebra", date: "2025-09-03T13:30:00" },
            { code: "213707", title: "Analytic and Vector Geometry", date: "2025-09-07T13:30:00" },
            { code: "212707", title: "Physics-I", date: "2025-09-14T13:30:00" },
            { code: "212709", title: "Physics-II", date: "2025-09-22T13:30:00" },
            { code: "212807", title: "Chemistry-I", date: "2025-10-12T13:30:00" },
            { code: "213607", title: "Introduction to Statistics", date: "2025-10-13T13:30:00" }
        ];

        const countdownContainer = document.getElementById('countdown-container');
        const routineTableBody = document.getElementById('routine-table-body');
        const clockElement = document.getElementById('clock');
        const yearElement = document.getElementById('year');
        const visitorCountElement = document.getElementById('visitor-count');

        // --- Firebase Setup ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'exam-countdown-default';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // --- End Firebase Setup ---

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const dateString = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            clockElement.innerHTML = `${dateString}<br>${timeString}`;
        }

        function createCountdownCard(exam, index) {
            const card = document.createElement('div');
            card.className = 'card-gradient p-6 rounded-xl shadow-lg flex flex-col items-center text-center countdown-item';
            card.style.animationDelay = `${index * 100}ms`;
            
            const title = document.createElement('h4');
            title.className = 'text-lg sm:text-xl font-bold mb-1 text-cyan-300';
            title.textContent = exam.title;
            card.appendChild(title);

            const code = document.createElement('p');
            code.className = 'text-sm font-mono mb-4 text-gray-400';
            code.textContent = `Code: ${exam.code}`;
            card.appendChild(code);

            const countdownDiv = document.createElement('div');
            countdownDiv.id = `countdown-${index}`;
            countdownDiv.className = 'flex justify-center space-x-3 sm:space-x-4 text-center';
            countdownDiv.innerHTML = `
                <div><span class="text-2xl sm:text-3xl md:text-4xl font-orbitron font-bold" id="days-${index}">0</span><p class="text-xs">Days</p></div>
                <div><span class="text-2xl sm:text-3xl md:text-4xl font-orbitron font-bold" id="hours-${index}">0</span><p class="text-xs">Hours</p></div>
                <div><span class="text-2xl sm:text-3xl md:text-4xl font-orbitron font-bold" id="minutes-${index}">0</span><p class="text-xs">Mins</p></div>
                <div><span class="text-2xl sm:text-3xl md:text-4xl font-orbitron font-bold" id="seconds-${index}">0</span><p class="text-xs">Secs</p></div>
            `;
            card.appendChild(countdownDiv);
            
            countdownContainer.appendChild(card);
        }

        function createTableRow(exam, index) {
            const row = document.createElement('tr');
            // On desktop, alternate row colors. Mobile will have its own background.
            row.className = 'md:odd:bg-gray-900/50 md:even:bg-gray-800/50';
            
            const examDate = new Date(exam.date);
            const formattedDate = examDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const day = examDate.toLocaleDateString('en-US', { weekday: 'long' });
            const time = examDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

            // Add data-label attributes for the mobile view
            row.innerHTML = `
                <td data-label="Code">${exam.code}</td>
                <td data-label="Paper Title">${exam.title}</td>
                <td data-label="Date">${formattedDate}</td>
                <td data-label="Day">${day}</td>
                <td data-label="Time">${time}</td>
            `;
            routineTableBody.appendChild(row);
        }

        function updateCountdowns() {
            const now = new Date().getTime();

            exams.forEach((exam, index) => {
                const examTime = new Date(exam.date).getTime();
                const distance = examTime - now;

                const daysEl = document.getElementById(`days-${index}`);
                const hoursEl = document.getElementById(`hours-${index}`);
                const minutesEl = document.getElementById(`minutes-${index}`);
                const secondsEl = document.getElementById(`seconds-${index}`);
                const countdownEl = document.getElementById(`countdown-${index}`);

                if (distance < 0) {
                    if(countdownEl.innerHTML.includes('Finished')) return;
                    countdownEl.innerHTML = '<p class="text-xl sm:text-2xl font-bold text-red-500">Exam Finished</p>';
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                daysEl.textContent = String(days).padStart(2, '0');
                hoursEl.textContent = String(hours).padStart(2, '0');
                minutesEl.textContent = String(minutes).padStart(2, '0');
                secondsEl.textContent = String(seconds).padStart(2, '0');
            });
        }

        async function manageVisitorCount() {
            try {
                const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (authToken) {
                    await signInWithCustomToken(auth, authToken);
                } else {
                    await signInAnonymously(auth);
                }

                const counterRef = doc(db, `artifacts/${appId}/public/data/site_stats/visits`);

                const newCount = await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    
                    if (!counterDoc.exists()) {
                        if (!sessionStorage.getItem('visit_counted')) {
                            transaction.set(counterRef, { count: 1 });
                            return 1;
                        }
                        return 0;
                    }

                    let currentCount = counterDoc.data().count;
                    if (!sessionStorage.getItem('visit_counted')) {
                        currentCount++;
                        transaction.update(counterRef, { count: currentCount });
                    }
                    return currentCount;
                });

                if (!sessionStorage.getItem('visit_counted')) {
                    sessionStorage.setItem('visit_counted', 'true');
                }

                visitorCountElement.textContent = newCount;

            } catch (error) {
                console.error("Error managing visitor count:", error);
                visitorCountElement.textContent = "N/A";
            }
        }

        function init() {
            yearElement.textContent = new Date().getFullYear();
            exams.forEach((exam, index) => {
                createCountdownCard(exam, index);
                createTableRow(exam, index);
            });
            updateClock();
            updateCountdowns();
            setInterval(updateClock, 1000);
            setInterval(updateCountdowns, 1000);
            manageVisitorCount();
        }

        window.onload = init;
    </script>
</body>
</html>
