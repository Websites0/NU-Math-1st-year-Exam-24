<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exam Countdown v2 | National University</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    /* [Your full CSS here — unchanged, skipped for brevity to focus on JS fix] */
  </style>
</head>
<body>
  <!-- [Your full HTML body here — unchanged, skipped for brevity to focus on JS fix] -->

  <!-- Firebase SDKs (non-module style) -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>

  <!-- Your custom JavaScript -->
  <script>
    const exams = [
      { code: "211501", title: "History Of Bangladesh", date: "2025-08-24T13:30:00" },
      { code: "213701", title: "Fundamentals of Mathematics", date: "2025-08-28T13:30:00" },
      { code: "213703", title: "Calculus - I", date: "2025-08-31T13:30:00" },
      { code: "213705", title: "Linear Algebra", date: "2025-09-03T13:30:00" },
      { code: "213707", title: "Analytic and Vector Geometry", date: "2025-09-07T13:30:00" },
      { code: "212707", title: "Physics-I", date: "2025-09-14T13:30:00" },
      { code: "212709", title: "Physics-II", date: "2025-09-22T13:30:00" },
      { code: "212807", title: "Chemistry-I", date: "2025-10-12T13:30:00" },
      { code: "213607", title: "Introduction to Statistics", date: "2025-10-13T13:30:00" }
    ];

    const countdownContainer = document.getElementById('countdown-container');
    const routineTableBody = document.getElementById('routine-table-body');
    const clockElement = document.getElementById('clock');
    const yearElement = document.getElementById('year');
    const visitorCountElement = document.getElementById('visitor-count');

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit' });
      const dateString = now.toLocaleDateString('en-US', { weekday: 'short', month: 'long', day: 'numeric' });
      clockElement.innerHTML = `${dateString} &bull; ${timeString}`;
    }

    function createCountdownCard(exam, index) {
      const card = document.createElement('div');
      card.className = 'glass-card p-6 rounded-xl shadow-lg flex flex-col items-center text-center';

      const title = document.createElement('h4');
      title.className = 'text-lg sm:text-xl font-bold mb-1 text-white';
      title.textContent = exam.title;
      card.appendChild(title);

      const code = document.createElement('p');
      code.className = 'text-sm font-mono mb-4 text-gray-400';
      code.textContent = `Code: ${exam.code}`;
      card.appendChild(code);

      const countdownDiv = document.createElement('div');
      countdownDiv.id = `countdown-${index}`;
      countdownDiv.className = 'flex justify-center space-x-3 sm:space-x-4 text-center mt-2';
      countdownDiv.innerHTML = `
        <div><span class="text-3xl sm:text-4xl font-orbitron font-bold text-sky-300" id="days-${index}">0</span><p class="text-xs text-gray-400 tracking-wider">DAYS</p></div>
        <div><span class="text-3xl sm:text-4xl font-orbitron font-bold text-cyan-300" id="hours-${index}">0</span><p class="text-xs text-gray-400 tracking-wider">HRS</p></div>
        <div><span class="text-3xl sm:text-4xl font-orbitron font-bold text-violet-300" id="minutes-${index}">0</span><p class="text-xs text-gray-400 tracking-wider">MINS</p></div>
        <div><span class="text-3xl sm:text-4xl font-orbitron font-bold text-pink-300" id="seconds-${index}">0</span><p class="text-xs text-gray-400 tracking-wider">SECS</p></div>
      `;
      card.appendChild(countdownDiv);
      countdownContainer.appendChild(card);
    }

    function createTableRow(exam) {
      const row = document.createElement('tr');
      row.className = 'md:hover:bg-white/5 transition-colors duration-200';

      const examDate = new Date(exam.date);
      const formattedDate = examDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
      const day = examDate.toLocaleDateString('en-US', { weekday: 'long' });
      const time = examDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

      row.innerHTML = `
        <td data-label="Code" class="p-3 font-mono">${exam.code}</td>
        <td data-label="Paper Title" class="p-3 text-left md:text-center">${exam.title}</td>
        <td data-label="Date" class="p-3">${formattedDate}</td>
        <td data-label="Day" class="p-3">${day}</td>
        <td data-label="Time" class="p-3">${time}</td>
      `;
      routineTableBody.appendChild(row);
    }

    function updateCountdowns() {
      const now = new Date().getTime();
      exams.forEach((exam, index) => {
        const examTime = new Date(exam.date).getTime();
        const distance = examTime - now;

        const countdownEl = document.getElementById(`countdown-${index}`);
        if (distance < 0) {
          if (!countdownEl.innerHTML.includes('Finished')) {
            countdownEl.innerHTML = '<p class="text-xl sm:text-2xl font-bold text-red-400">Exam Finished</p>';
          }
          return;
        }

        document.getElementById(`days-${index}`).textContent = String(Math.floor(distance / 86400000)).padStart(2, '0');
        document.getElementById(`hours-${index}`).textContent = String(Math.floor((distance % 86400000) / 3600000)).padStart(2, '0');
        document.getElementById(`minutes-${index}`).textContent = String(Math.floor((distance % 3600000) / 60000)).padStart(2, '0');
        document.getElementById(`seconds-${index}`).textContent = String(Math.floor((distance % 60000) / 1000)).padStart(2, '0');
      });
    }

    async function manageVisitorCount() {
      try {
        await auth.signInAnonymously();
        const counterRef = db.doc("artifacts/exam-countdown-v2-default/public/data/site_stats/visits");

        const newCount = await db.runTransaction(async (transaction) => {
          const counterDoc = await transaction.get(counterRef);
          let currentCount = counterDoc.exists ? counterDoc.data().count : 0;
          if (!sessionStorage.getItem('visit_counted')) {
            currentCount++;
            transaction.set(counterRef, { count: currentCount }, { merge: true });
          }
          return currentCount;
        });

        if (!sessionStorage.getItem('visit_counted')) {
          sessionStorage.setItem('visit_counted', 'true');
        }

        visitorCountElement.textContent = newCount.toLocaleString();
      } catch (error) {
        console.error("Error managing visitor count:", error);
        visitorCountElement.textContent = "N/A";
      }
    }

    function init() {
      yearElement.textContent = new Date().getFullYear();
      exams.forEach((exam, index) => {
        createCountdownCard(exam, index);
        createTableRow(exam);
      });
      updateClock();
      updateCountdowns();
      setInterval(updateClock, 1000);
      setInterval(updateCountdowns, 1000);
      manageVisitorCount();
    }

    window.onload = init;
  </script>
</body>
</html>
